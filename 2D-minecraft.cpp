#include <Adafruit_GFX.h>    // Core graphics library
#include <Adafruit_ST7735.h> // Hardware-specific library for ST7735
#include <SPI.h>
#include "esp_system.h"
#define TFT_CS        5
#define TFT_RST        4 // Or set to -1 and connect to Arduino RESET pin
#define TFT_DC         2
#define SCREEN_WIDTH 160 // OLED display width, in pixels
#define SCREEN_HEIGHT 128 // OLED display height, in pixels
Adafruit_ST7735 tft = Adafruit_ST7735(TFT_CS, TFT_DC, TFT_RST);

#define but1 33
#define but2 32
#define but3 25
#define joyy 35
#define joyx 34

#define WorldW 128
#define WorldH 128
#define Surface 32
#define numOre 4

//шансы генерации блоков под землей (умножены на 10)
#define chanceStone 150   //15%
#define chanceOre1 50   //5%
#define chanceOre2 20   //2%
#define chanceOre3 10   //1%
#define chanceOre4 5   //0.5%

uint16_t playerX = WorldW/2;
uint16_t playerY = Surface-1;
uint64_t tmr = 0;
uint64_t tmr1 = 0;

#define numOfSprites 12

const uint16_t sprites[numOfSprites][64] PROGMEM = {
  {
    //земля с травой 0
  0x8eeb, 0x8eeb, 0x96eb, 0xcfee, 0xcfee, 0x8eeb, 0x96eb, 0xcfee,
  0x8eeb, 0x96eb, 0xcfed, 0x8eeb, 0x8eeb, 0x8eeb, 0x8eeb, 0x8eeb,
  0x8eeb, 0x8eeb, 0x8eeb, 0x3d2e, 0x3d0e, 0x8eeb, 0x8eeb, 0x3d2e, 
  0x3d0e, 0x3d0e, 0x3d0e, 0xc619, 0xab8e, 0x3d0e, 0x3d0e, 0x3d0e,
  0xcc30, 0x3d0e, 0x92cb, 0xab8e, 0xab8e, 0xab8e, 0xcc30, 0xcc30,
  0xab8e, 0xab8e, 0x92cb, 0xab8e, 0x92cb, 0xc5f9, 0xab8e, 0xab8e, 
  0x92cb, 0xcc30, 0xab8e, 0x92cb, 0x92cb, 0x92cb, 0x92cb, 0xab8e,
  0x92cb, 0x92cb, 0x92cb, 0x92cb, 0x92cb, 0x92cb, 0x92cb, 0x92cb
  },
  {
    //земля 1
  0x92cb, 0x92cb, 0x92cb, 0x92cb, 0x92cb, 0x92cb, 0x92cb, 0x92cb,
  0x92cb, 0x92cb, 0xab8e, 0x92cb, 0x92cb, 0x92cb, 0xab8e, 0x92cb,
  0x92cb, 0xab8e, 0x92cb, 0xab8e, 0x92cb, 0x92cb, 0x92cb, 0x92cb, 
  0x92cb, 0x92cb, 0xab8e, 0x92cb, 0x92cb, 0x92cb, 0x92cb, 0x92cb,
  0x92cb, 0x92cb, 0x92cb, 0x92cb, 0x92cb, 0xab8e, 0x92cb, 0xab8e,
  0x92cb, 0x92cb, 0x92cb, 0x92cb, 0xab8e, 0x92cb, 0xab8e, 0x92cb, 
  0x92cb, 0x92cb, 0x92cb, 0x92cb, 0x92cb, 0xab8e, 0x92cb, 0xab8e,
  0xab8e, 0x92cb, 0x92cb, 0x92cb, 0xab8e, 0x92cb, 0xab8e, 0x92cb
  },
  {
    //камень 2
  0xc61a, 0x630e, 0x5aed, 0x2946, 0x2126, 0x2126, 0x2126, 0x2126,
  0x630e, 0x630e, 0x630e, 0x5aed, 0x2946, 0x4209, 0x2126, 0x2126,
  0xc61a, 0x630e, 0x630e, 0x630e, 0x4209, 0x2946, 0x4209, 0x2126, 
  0xc61a, 0xc61a, 0xc619, 0x630e, 0x630e, 0x4209, 0x2946, 0x2126,
  0x8412, 0xc61a, 0x8412, 0xbdf9, 0x630e, 0x630e, 0x5aed, 0x2946,
  0xc61a, 0xffff, 0xc61a, 0x7bf2, 0x630e, 0x630e, 0x630e, 0x630e, 
  0xffff, 0x632e, 0xffff, 0xc61a, 0xc61a, 0x630e, 0xbdf9, 0x630e,
  0x8412, 0xffff, 0x630e, 0x7bf2, 0xc61a, 0xc61a, 0x630e, 0x630e
  },
  {
    //туф 3
  0xc61a, 0xc61a, 0x7bf1, 0x7bf2, 0x7bf2, 0x7bf2, 0x7bf2, 0x7bf2,
  0x7bf2, 0x7bf2, 0x7bf2, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a,
  0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xfffd, 0xc61a, 0x8412, 0xc61a, 
  0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xfffd, 0xc61a, 0xc61a,
  0x7bf1, 0x7bf2, 0x7bf2, 0x7bf2, 0x7bf2, 0x7bf2, 0x7bf2, 0x7bf2,
  0x7bf2, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 
  0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0x7bf2, 0x7bf1, 0x7bf1,
  0xc61a, 0x7bf2, 0xc61a, 0x7bf2, 0x7bf1, 0x7bf1, 0x7bf1, 0x7bf1
  },
  {
    //руда1 4
  0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a,
  0xc61a, 0xc61a, 0x7bf1, 0x7bf1, 0xc61a, 0xc61a, 0xc61a, 0xc61a,
  0xc61a, 0xc619, 0x422a, 0x422a, 0xc619, 0xc61a, 0x7bf2, 0x7bf2, 
  0xc61a, 0x422a, 0x422a, 0x422a, 0x422a, 0xc61a, 0xc61a, 0xc61a,
  0xc61a, 0xc619, 0xc619, 0x7bf2, 0x7bf1, 0xc61a, 0xc61a, 0xc61a,
  0xc61a, 0x422a, 0x422a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 
  0xc61a, 0xc619, 0xc61a, 0xc61a, 0xc61a, 0x422a, 0x422a, 0xc61a,
  0x422a, 0x422a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a
  },
  {
    //руда2 5
  0xc61a, 0x81cd, 0x7bf1, 0xc61a, 0xba50, 0xfb52, 0xfb73, 0xc61a,
  0xc61a, 0xc61a, 0xc61a, 0xc61a, 0x81ad, 0xba50, 0xfb52, 0xc61a,
  0xc61a, 0x81cd, 0x81cd, 0xc61a, 0x81cd, 0x81ad, 0xba50, 0xc61a, 
  0xc61a, 0x7bf1, 0x7bf1, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a,
  0xba50, 0xfb52, 0xfb73, 0xc61a, 0x81cd, 0xba50, 0xc61a, 0xc61a,
  0x81ad, 0xba50, 0xfb52, 0xc61a, 0xc61a, 0x7bf1, 0x630e, 0xc61a, 
  0x81ad, 0x81ad, 0xba50, 0xc61a, 0xc61a, 0xba50, 0xfb52, 0xc61a,
  0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0x81ad, 0xba50, 0xc61a
  },
  {
    //руда3 6
  0xc61a, 0xcfee, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a,
  0x3d2e, 0x8eeb, 0xcfee, 0xc61a, 0xc61a, 0xcfee, 0xc61a, 0xc61a,
  0xc61a, 0x3d0e, 0x7c11, 0xc61a, 0x3d0e, 0x8eeb, 0xcfee, 0xc61a, 
  0xc61a, 0xc61a, 0xc61a, 0xc61a, 0x7bf1, 0x3d2e, 0xc61a, 0xc61a,
  0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a,
  0xc61a, 0xc61a, 0xcfee, 0xc61a, 0xc61a, 0x96eb, 0xcfee, 0xc61a, 
  0xc61a, 0x3d0e, 0x8eeb, 0xcfee, 0xc61a, 0x7c11, 0x3d2e, 0xc61a,
  0xc61a, 0x7bf1, 0x3d0e, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a
  },
  {
    //руда4 7
  0x49ef, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a, 0xc61a,
  0x7bf2, 0xc61a, 0xc61a, 0x4d3f, 0x4d3f, 0xc61a, 0x553f, 0xc61a,
  0xc61a, 0xc61a, 0x49ef, 0x4ad5, 0x4d3f, 0xc61a, 0x7c12, 0xc61a, 
  0xc61a, 0xc61a, 0x49ef, 0x49ef, 0x7bf2, 0xc61a, 0xc61a, 0xc61a,
  0xc61a, 0xc61a, 0x7bf2, 0x7bf2, 0xc61a, 0xc61a, 0xc61a, 0xc61a,
  0xc61a, 0x4d3f, 0x4d3f, 0xc61a, 0x553f, 0xc61a, 0xc61a, 0x4d3f, 
  0x49ef, 0x4ad5, 0x4d3f, 0xc61a, 0xc61a, 0xc61a, 0x49ef, 0x4ad5,
  0x41cf, 0x49ef, 0x7bf2, 0xc61a, 0xc61a, 0xc61a, 0x49ef, 0x41cf
  },
  {
    //небо 8
  0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff,
  0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff,
  0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff,
  0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff,
  0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff,
  0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff,
  0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff, 0x5ff
  },
  {
    //земля/фон 9
  0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164,
  0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164,
  0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 
  0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164,
  0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164,
  0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 
  0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164,
  0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164, 0x4164
  },
  {
    //Лестница 10
  0xc618, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0xc618,
  0xc618, 0x6b4d, 0x6b4d, 0x6b4d, 0x6b4d, 0x6b4d, 0x6b4d, 0xc618,
  0xc618, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0xc618, 
  0xc618, 0x6b4d, 0x6b4d, 0x6b4d, 0x6b4d, 0x6b4d, 0x6b4d, 0xc618,
  0xc618, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0xc618,
  0xc618, 0x6b4d, 0x6b4d, 0x6b4d, 0x6b4d, 0x6b4d, 0x6b4d, 0xc618, 
  0xc618, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0xc618,
  0xc618, 0x6b4d, 0x6b4d, 0x6b4d, 0x6b4d, 0x6b4d, 0x6b4d, 0xc618
  },
  {
    //игрок 11
  0xd69a, 0xc618, 0xc618, 0xc618, 0xc618, 0xc618, 0xc618, 0xd69a,
  0xdedb, 0x8c71, 0x8410, 0x8410, 0x8410, 0x8410, 0x8c71, 0xce79,
  0xc618, 0x8410, 0xdedb, 0xdefb, 0xdefb, 0xffff, 0x8410, 0xc618, 
  0xc618, 0x8410, 0xc638, 0xd69a, 0xdefb, 0xdefb, 0x8410, 0xc618,
  0xc618, 0x8410, 0xbdd7, 0xd69a, 0xd69a, 0xdedb, 0x8410, 0xc618,
  0xc618, 0x7bef, 0x9492, 0x8c71, 0xad55, 0xce59, 0x8410, 0xc618, 
  0xc618, 0x8430, 0x8410, 0x8410, 0x8410, 0x8410, 0x8430, 0xc618,
  0xce59, 0xd69a, 0xc618, 0xc618, 0xc618, 0xc618, 0xc618, 0xc638
  }
};

typedef struct __attribute__((packed)) {
  uint8_t type;
  uint8_t flags;  // 0-сломан, 1-может двигаться, 2-прорисован, 3-не может сломаться, 4-нет колизии
} Block;

const uint16_t Depth_Bar_16x128[] PROGMEM = {
  0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x738e, 0x738e, 0x738e, 0x738e, 0x738e, 0x738e, 0x738e, 0x738e, 0x738e, 0x738e, 0x738e, 0x738e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x73ae, 0x73ae, 0x73ae, 0x73ae, 0x73ae, 0x73ae, 0x73ae, 0x73ae, 0x73ae, 0x73ae, 0x73ae, 0x738e, 0x4209, 0x4209, 0x4209, 0x4209, 0x7bcf, 0x7bcf, 0x7bcf, 0x7bcf, 0x7bcf, 0x7bcf, 
  0x7bcf, 0x7bcf, 0x7bcf, 0x7bcf, 0x7bcf, 0x73af, 0x4209, 0x4209, 0x4209, 0x4209, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x7bef, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x8410, 0x8410, 0x8410, 0x8410, 0x8410, 0x8410, 0x8410, 0x8410, 0x8410, 0x8410, 0x8410, 0x8410, 0x4209, 0x4209, 0x4209, 0x4209, 0x8430, 0x8430, 0x8430, 0x8430, 0x8430, 0x8430, 
  0x8430, 0x8430, 0x8430, 0x8430, 0x8430, 0x8430, 0x4209, 0x4209, 0x4209, 0x4209, 0x8431, 0x8c51, 0x8c51, 0x8c51, 0x8c51, 0x8c51, 0x8c51, 0x8c51, 0x8c51, 0x8c51, 0x8c51, 0x8430, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x8c71, 0x8c71, 0x8c71, 0x8c71, 0x8c71, 0x8c71, 0x8c71, 0x8c71, 0x8c71, 0x8c71, 0x8c71, 0x8c71, 0x4209, 0x4209, 0x4209, 0x4209, 0x9492, 0x9492, 0x9492, 0x9492, 0x9492, 0x9492, 
  0x9492, 0x9492, 0x9492, 0x9492, 0x9492, 0x9492, 0x4209, 0x4209, 0x4209, 0x4209, 0x94b2, 0x94b2, 0x94b2, 0x94b2, 0x94b2, 0x94b2, 0x94b2, 0x94b2, 0x94b2, 0x94b2, 0x94b2, 0x94b2, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x9cd3, 0x9cd3, 0x9cd3, 0x9cd3, 0x9cd3, 0x9cd3, 0x9cd3, 0x9cd3, 0x9cd3, 0x9cd3, 0x9cd3, 0x9cd3, 0x4209, 0x4209, 0x4209, 0x4209, 0x9cf3, 0x9cf3, 0x9cf3, 0x9cf3, 0x4ad5, 0x4ad5, 
  0x4ad5, 0x4ad5, 0x9cf3, 0x9cf3, 0x9cf3, 0x9cf3, 0x4209, 0x4209, 0x4209, 0x4209, 0xa514, 0xa514, 0xa514, 0xa514, 0x4ad5, 0x4ad5, 0x4ad5, 0x4ad5, 0xa514, 0xa514, 0xa514, 0xa514, 0x4209, 0x4209, 
  0x4209, 0x4209, 0xa534, 0xa534, 0xa534, 0xa534, 0x4ad5, 0x4ad5, 0x4ad5, 0x4ad5, 0xa534, 0xa534, 0xa534, 0xa534, 0x4209, 0x4209, 0x4209, 0x4209, 0xad55, 0xad55, 0xad55, 0xad55, 0x4ad5, 0x4ad5, 
  0x4ad5, 0x4ad5, 0xad55, 0xad55, 0xad55, 0xad55, 0x4209, 0x4209, 0x4209, 0x4209, 0xad75, 0x4af5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4af5, 0xad75, 0x4209, 0x4209, 
  0x4209, 0x4209, 0xb596, 0x4af5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4af5, 0xb596, 0x4209, 0x4209, 0x4209, 0x4209, 0xb5b6, 0xb5b6, 0x4af5, 0x4ad5, 0x4ad5, 0x4ad5, 
  0x4ad5, 0x4ad5, 0x4ad5, 0x4af5, 0xb5b6, 0xb5b6, 0x4209, 0x4209, 0x4209, 0x4209, 0xbdd7, 0xbdd7, 0xbdd7, 0x4af5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4ad5, 0x4af5, 0xbdd7, 0xbdd7, 0xbdd7, 0x4209, 0x4209, 
  0x4209, 0x4209, 0xbdf7, 0xbdf7, 0xbdf7, 0xbdf7, 0x4af5, 0x4ad5, 0x4ad5, 0x4af5, 0xbdf7, 0xbdf7, 0xbdf7, 0xbdf7, 0x4209, 0x4209, 0x4209, 0x4209, 0xc618, 0xc618, 0xc618, 0xc618, 0xc618, 0x4af5, 
  0x4af5, 0xc618, 0xc618, 0xc618, 0xc618, 0xc618, 0x4209, 0x4209, 0x4209, 0x4209, 0xc638, 0xc638, 0xc638, 0xc638, 0xc638, 0xc638, 0xc638, 0xc638, 0xc638, 0xc638, 0xc638, 0xc638, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 
  0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x630e, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 
  0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x4209, 0x630e
};
#define Barstart 26
#define Barstop 126

Block world[WorldW][WorldH];

uint32_t Random(uint32_t Min, uint32_t Max) {
  return Min + (esp_random() % (Max-Min+1));
}

void generateWorld() {
  tft.print("Generating...");
  int range = WorldH-Surface;
  int persentOre = range/numOre;
  for (int k = 0; k < Surface; k++) {
    for (int n = 0; n < WorldW; n++) {
      world[n][k] = {8, 0b00010100};     //генерируем небо
    }
  }
  for (int i = 0; i < WorldW; i++) {
    world[i][Surface] = {0, 0b00000100};      //генерируем траву
  }
  for (int g = Surface+1; g < WorldH; g++) {
    for (int v = 0; v < WorldW; v++) {
      uint32_t rnd = Random(0, 1000);
      world[v][g] = {1, 0b00000100};      //генерируем землю
      if (rnd <= chanceStone) {
        world[v][g] = {2, 0b00001100};         //генерируем камни 
      }
      if (rnd <= chanceOre1 && g <= persentOre*3+Surface) {
        world[v][g] = {4, 0b00000100};         //генерируем руду1
      }
      if (rnd <= chanceOre2 && g <= persentOre*2+Surface) {
        world[v][g] = {5, 0b00000100};         //генерируем руду2
      }
      if (rnd <= chanceOre3 && g <= persentOre+Surface) {
        world[v][g] = {6, 0b00000100};         //генерируем руду3
      }
      if (rnd <= chanceOre4) {
        world[v][g] = {7, 0b00000100};         //генерируем руду4
      }
        
    }
  }
  return;
}

void drawBitmp(int x, int y, uint8_t type, int scale) {
  int counter = 0;
  for (int k = y; k < y+8*scale; k += scale) {
    for (int i = x; i < x+8*scale; i += scale) {
      tft.fillRect(i, k, scale, scale, sprites[type][counter]);
      counter++;
    }
  }
  return;
}

void drawBar(int persent) {
  tft.drawRGBBitmap(0, 0, Depth_Bar_16x128, 16, 128);
  tft.fillRect(3, Barstart, 10, persent, 0x8eeb);
  if (persent >= 100) persent = 99;
  tft.setCursor(3, 3);
  if (persent < 10) tft.setCursor(6, 3);
  tft.setTextColor(ST77XX_WHITE);
  tft.print(persent);
  return;
}

void render(int scale) {
  tft.fillScreen(ST77XX_BLACK);
  uint8_t blockType = 0;
  int blockX = 0;
  int blockY = 0;
  for (int i = playerX-(((SCREEN_WIDTH-16)/(8*scale))/2); i <= playerX+1+((SCREEN_WIDTH-16)/(8*scale))/2; i++) {
    for (int n = playerY-(SCREEN_HEIGHT/(8*scale))/2; n <= playerY+(SCREEN_HEIGHT/(8*scale))/2; n++) {
      Serial.print(i);
      Serial.print("/");
      Serial.print(n);
      Serial.print("/");
      Serial.print(world[i][n].type);
      Serial.print("/");
      Serial.print(blockX);
      Serial.print("/");
      Serial.print(blockY);
      Serial.print("/");
      Serial.print(world[i][n].flags, BIN);
      Serial.print(" ");
      if (i > WorldW-1) {
        blockType = world[(i-(WorldW-1))-1][n].type;
      }else if (i < 0) {
        blockType = world[i+WorldW][n].type;
      }else{
        blockType = world[i][n].type;
      }
      drawBitmp(blockX*(8*scale)+16, blockY*(8*scale), blockType, scale);
      blockY++;
    }
    blockY = 0;
    Serial.println();
    blockX++;
  }
  drawBitmp(80, 64, numOfSprites-1, scale);   //player
  float persent1 = (float)(WorldH-Surface)/100;
  float persent2 = (float)(playerY-Surface);
  if (playerY-Surface < 0 ) persent2 = 0;
  float persent3 = persent1*persent2;
  drawBar((int)persent3);
  tft.setCursor(32, 0);
  tft.print("X");
  tft.print(playerX);
  tft.print("/Y");
  tft.print(playerY);
  return;
}

void gravity() {
  while (((world[playerX][playerY+1].flags & (1<<0)) || (world[playerX][playerY+1].flags & (1<<4))) && (world[playerX][playerY+1].type != 10)) {
    playerY++;
    render(2);
    delay(25);
  }
  return;
}

void setup() {
  Serial.begin(115200);
  Serial.print("Testing random... ");
  Serial.print(Random(32, 64));
  playerX = Random(0, WorldW-1);
  tft.initR(INITR_BLACKTAB);      // Init ST7735S chip, black tab
  tft.setSPISpeed(70000000);
  tft.fillScreen(ST77XX_BLACK);
  tft.setRotation(3);
  pinMode(but1, INPUT);
  pinMode(but2, INPUT);
  pinMode(but3, INPUT);
  //drawBar(100);
  /*
  drawBitmp(32, 32, 0, 1);
  drawBitmp(40, 32, 0, 2);
  drawBitmp(56, 32, 0, 3);
  */
  tft.setTextSize(1);   
  tft.setTextColor(ST7735_WHITE);
  tft.setCursor(32,0); 
  generateWorld();
  render(2);
  world[60][Surface-1] = {2, 0b00001100};
  world[59][Surface-1] = {3, 0b00001100};
  world[58][Surface-1] = {4, 0b00001100};
  world[57][Surface-1] = {5, 0b00001100};
  world[56][Surface-1] = {6, 0b00001100};
  world[55][Surface-1] = {7, 0b00001100};
  
}

void loop() {
  if (millis()-tmr >= 300) {
    tmr = millis();
    if (analogRead(joyx) >= 2500) {
      if (playerX == 0) {
        if (world[WorldW-1][playerY].flags & (1<<0) || world[WorldW-1][playerY].flags & (1<<4)) {
        playerX = WorldW-1;
        render(2);
        gravity();
      }else if ((world[WorldW-1][playerY].flags & (1<<3)) == 0) {
        world[WorldW-1][playerY].flags |= (1<<0);
        world[WorldW-1][playerY].type = 9;
        playerX = WorldW-1;
        render(2);
        gravity();
      }
      }else if (world[playerX-1][playerY].flags & (1<<0) || world[playerX-1][playerY].flags & (1<<4)) {
        playerX--;
        render(2);
        gravity();
      }else if ((world[playerX-1][playerY].flags & (1<<3)) == 0) {
        world[playerX-1][playerY].flags |= (1<<0);
        world[playerX-1][playerY].type = 9;
        playerX--;
        render(2);
        gravity();
      }
    }else if (analogRead(joyx) <= 800) {
      if (playerX == 127) {
        if (world[0][playerY].flags & (1<<0) || world[0][playerY].flags & (1<<4)) {
          playerX = 0;
          render(2);
          gravity();
        }else if ((world[0][playerY].flags & (1<<3)) == 0) {
          world[0][playerY].flags |= (1<<0);
          world[0][playerY].type = 9;
          playerX = 0;
          render(2);
          gravity();
        }
      }else if (world[playerX+1][playerY].flags & (1<<0) || world[playerX+1][playerY].flags & (1<<4)) {
        playerX++;
        render(2);
        gravity();
      }else if ((world[playerX+1][playerY].flags & (1<<3)) == 0) {
        world[playerX+1][playerY].flags |= (1<<0);
        world[playerX+1][playerY].type = 9;
        playerX++;
        render(2);
        gravity();
      }
    }
    if (analogRead(joyy) >= 2500) {
      if ((world[playerX][playerY-1].flags & (1<<0)) || (world[playerX][playerY-1].flags & (1<<4))) {
        world[playerX][playerY].flags = 0b00111;
        world[playerX][playerY].type = 10;
        playerY--;
        render(2);
        gravity();
      }else if ((world[playerX][playerY-1].flags & (1<<3)) == 0) {
        world[playerX][playerY].flags = 0b00111;
        world[playerX][playerY].type = 10;
        world[playerX][playerY-1].flags |= (1<<0);
        world[playerX][playerY-1].type = 9;
        playerY--;
        render(2);
        gravity();
      }else if (world[playerX][playerY-1].type == 10) {
        playerY--;
        render(2);
        gravity();
      }
    }else if (analogRead(joyy) <= 800) {
      if (world[playerX][playerY+1].flags & (1<<0) || world[playerX][playerY+1].flags & (1<<4)) {
        playerY++;
        render(2);
        gravity();
      }else if ((world[playerX][playerY+1].flags & (1<<3)) == 0) {
        world[playerX][playerY+1].flags |= (1<<0);
        world[playerX][playerY+1].type = 9;
        playerY++;
        render(2);
        gravity();
      }
    }
  }
}
